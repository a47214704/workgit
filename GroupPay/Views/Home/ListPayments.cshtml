@using Core;

@{
    ViewData["Title"] = "支付订单列表";
}
<partial name="_ConsoleHeader" />

<div class="content" id="target"></div>
<script id="ractiveTemplate" type="text/reactive">
	<div class="search-row">
		<label>支付渠道：</label><select id="channel" name="channel" value='{{channel}}'>
        	<option value="0">全部</option>
			<option value="1">微信</option>
			<option value="2">支付宝</option>
            <option value="3">银行卡</option>
            <option value="4">支付宝红包</option>
            <option value="5">云闪付</option>
		</select>
		<label>订单号：</label><input type="text" name="orderId" id="orderId" value="{{orderId}}" />
		<label>平台单号：</label><input type="text" name="platformOrderId" id="platformOrderId" value="{{platformOrderId}}" />
		<label>状态：</label><select id="Status" name="Status" value='{{status}}'>
            <option value="0">全部</option>
			<option value="1">等待中</option>
			<option value="2">已接受</option>
			<option value="3">已付款</option>
			<option value="4">已清算</option>
			<option value="5">已取消</option>
		</select>
	</div>
    <div class="search-row">
        <label>创建时间：</label>
        <input type="text" name="startDate" id="startDate" value="{{startDate}}" />
        <input type="text" name="startTime" id="startTime" value="{{startTime}}" />
        <label>至　</label>
        <input type="text" name="endDate" id="endDate" value="{{endDate}}" />
        <input type="text" name="endTime" id="endTime" value="{{endTime}}" />
        <label>抢单员：</label><input type="text" name="accountName" id="accountName" value="{{accountName}}" />
        <input type="button" name="searchBtn" id="searchBtn" value="查找" on-click="doSearch" />
        <input type="button" value="新增订单" on-click="createOrder" />
    </div>
	<div style="color:blue;padding:0 0 10px 0;">{{message}}</div>
	<table class="listTable">
		<thead>
			<th>订单号</th>
			<th>平台订单号</th>
			<th>金额</th>
			<th>支付渠道</th>
			<th>状态</th>
			<th>抢单员</th>
			<th>创建时间</th>
			<th>操作</th>
		</thead>
		<tbody>
			{{#each payments}}
			<tr>
				<td>{{id}}</td>
				<td>{{merchantReferenceNumber}}</td>
				<td>{{amount / 100}}</td>
                <td>{{#if channel}}{{channelType[channel]}}{{else}}--{{/if}}</td>
				<td>{{#if status == 1}}等待中{{elseif status == 2}}已接受{{elseif status == 3}}已付款{{elseif status == 4}}已清算{{else}}已取消{{/if}}</td>
				<td>{{accountName}}</td>
				<td>{{formatTimestamp(createTimestamp)}}</td>
				<td>
				{{#if (status == 2 || status == 5) && accountName!=""}}
					@if (this.Context.User.HasRole("PaymentWriter"))
					{
						<a href="javascript:void(0);" on-click="reOrder">补单</a>
                    }
                    else
                    {
                        @("--")
                    }
                    {{else}}
					--
				{{/if}}
				</td>
			</tr>
			{{/each}}
		<tbody>
	</table>
	<div class="pager">
		<span>共 {{totalRecords}} 条</span>
        {{#each pages as p}}
			{{#if p == currentPage || p == -1}}
				<span>{{#if p == -1}}...{{else}}{{p}}{{/if}}</span>
			{{else}}
				<a href="javascript:void(0);" on-click="doPage">{{p}}</a>
			{{/if}}
        {{/each}}
    </div>
</script>

@section Scripts{
<script type="text/javascript">
	$(document).ready(initPaymentListPage);
</script>
}