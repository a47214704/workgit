<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>GroupPay</title>
    <link rel="stylesheet" type="text/css" href="../css/mui.min.css"/>
    <link rel="stylesheet" href="../css/own.css" />
</head>
<body>
	<div class="mui-content">
		<div class="user-info">
			<div class="avatar">
				<span id="avatar" class="mui-icon mui-icon-person" style="font-size: 4.2em;"></span> 
			</div>
			<div class="profile">
				<p>ID:<span id="uid"></span></p>
				<p>账号:<span id="account"></span></p>
				<p>服务分:<span id="service">0</span></p>
			</div>
		</div>
		<ul class="mui-table-view" style="margin-top: 10px;">
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="changepsd-needtem.html">
					修改密码
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a  class="mui-navigate-right" href="security-question.html">
					修改密保
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="#">
					修改支付密码
				</a>
			</li>
		</ul>
		
		<ul class="mui-table-view" style="margin-top: 20px;">
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="brokerage-needtem.html">
					我的利润
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="#">
					好友转账
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="bankaccount-needtem.html">
					收款管理
				</a>
			</li>
			<!--<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="payment.html">
					充值
				</a>
			</li>-->
		</ul>
		
		<ul class="mui-table-view" style="margin-top: 20px;">
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="recharge_list.html">
					充值记录
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="#">
					兑奖记录
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="#">
					转账记录
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a class="mui-navigate-right" href="#">
					资金明细
				</a>
			</li>
		</ul>
		
		<ul id="logoutBtn" class="mui-table-view" style="margin-top: 20px;margin-bottom: 20px;">
			<li class="mui-table-view-cell" style="text-align: center;">
				<span style="color:#00B82B">退出登录</span>
			</li>
		</ul>
	</div>
	<script src="../js/mui.min.js" charset="UTF-8"></script>
	<script type="text/javascript" src="../js/own.js" ></script>
	<script type="text/javascript" src="../js/network.js" ></script>
	<script type="text/javascript" charset="UTF-8">
		mui.init({
			swipeBack:false
		});
		
		var logoutBtn;
		var parentWebView;
		var currentWebView;
		var uid;
		var account;
		
		mui.plusReady(function() {
			currentWebView = plus.webview.currentWebview();
			parentWebView = currentWebView.parent();
			logoutBtn = document.getElementById('logoutBtn');
			uid = document.getElementById("uid");
			account = document.getElementById("account");
			
			//设置用户信息
			if (localStorage.getItem('user')) {
				setUserInfo();
			}
			
			currentWebView.addEventListener('show', function() {
				setUserInfo();
			}, false);
			
			mui('.mui-table-view').on('tap','a',function(){
				var id = this.getAttribute('href');
				if (id == '#') {
					mui.toast('该功能暂未开放');
					return;
				}
				var href = this.href;
				var title = this.innerText;
				
				mui.fire(parentWebView,'newWebView',{
					id:id,
					href:href,
					aniShow:getaniShow(),
					title:title
				});
			});
			
			//接收登录成功事件
			window.addEventListener('loginSuccess',function(){
				setUserInfo();				
			},false);
			
			//退出登录
			logoutBtn.addEventListener('tap',function(){
				localStorage.removeItem('user');
				mui.fire(parentWebView,'newWebView',{
					id:'pages/login.html',
					href:'pages/login.html',
					aniShow:'slide-in-bottom'
				});
				mui.toast('账号已安全退出');
			},false);
		});
		
		function setUserInfo() {
			var user = JSON.parse(localStorage.getItem('user'));
			uid.innerText = user.id;
			account.innerText = user.accountName;
			
			network.get_user_info(user.id);
		}
		
		function userInfoSuccess(data) {
			if (data.result) {
				if (data.result.status != 1) {
					localStorage.removeItem('user');
					mui.toast('您的账号存在问题，请重新登陆');
				} else {
					var coin = data.result.balance;
					coin = coin.toFixed(2);
					var user = JSON.parse(localStorage.getItem('user'));
					user.avatar = data.result.avatar;
					user.balance = coin;
					user.promotionCode = data.result.promotionCode;
					user.nickName = data.result.nickName;
					user.status = data.result.status;
					localStorage.setItem('user', JSON.stringify(user));
				}
			} else {
				mui.toast('获取用户信息失败');
			}
		}
		
		function userInfoError(status) {
			//if (status == 401 || status == 403) {
				mui.toast('登录信息已过期，请重新登录');
				localStorage.removeItem('user');
				mui.fire(parentWebView,'newWebView',{
					id:'pages/login.html',
					href:'pages/login.html',
					aniShow:'slide-in-bottom'
				});
			//} else {
			//	mui.toast('unknow status:' + status);
			//}
		}
	</script>
</body>
</html>