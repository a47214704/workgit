<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>修改密码</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<link href="../css/mui.min.css" rel="stylesheet" />
	<link rel="stylesheet" type="text/css" href="../css/own.css"/>
</head>
<body>
	<header class="mui-bar mui-bar-nav own-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">修改密码</h1>
	</header>
	
	<div class="mui-content"  style="margin: 10px">
		<form class="mui-input-group">
			<div class="mui-input-row">
				<input type="password" class="mui-input-clear" placeholder="请输入旧密码" />
			</div>
			<div class="mui-input-row">
				<input type="password" class="mui-input-clear" placeholder="输入新密码" />
			</div>
			<div class="mui-input-row">
				<input type="password" class="mui-input-clear" placeholder="确认新密码" />
			</div>
		</form>
		<div class="mui-button-row" style="margin-top: 10px;">
			<button type="button" id="updateBtn" class="mui-btn own-btn-green mui-btn-block" style="padding: 5px 0px;">修改密码</button>
		</div>
	</div>
	
	<script src="../js/mui.min.js"></script>
	<script type="text/javascript" src="../js/own.js" ></script>
	<script type="text/javascript" src="../js/network.js" ></script>
	<script type="text/javascript">
		mui.init({
			swipeBack:false
		});
		
		var inputList;
		var changepwdWebview;
		var updateBtn;
		
		mui.plusReady(function() {
			inputList = document.querySelectorAll('input[type="password"]');
			updateBtn = document.getElementById("updateBtn");
			changepwdWebview = plus.webview.currentWebview();
			
			updateBtn.addEventListener('tap', function() {
				for (var i = 0;i < inputList.length; i++) {
					if (inputList[i].value.length <= 0) {
						var errorMsg;
						if (i == 0) {
							errorMsg = '请输入旧密码';
						} else if(i == 1){
							errorMsg = '请输入新密码';
						} else if(i == 2 ) {
							errorMsg = '两次输入密码必须一致';
						}
						mui.toast(errorMsg);
						return;
					}
				}
				
				if (inputList[1].value != inputList[2].value) {
					mui.toast('两次输入密码必须一致');
					return;
				}
				
				var user = JSON.parse(localStorage.getItem('user'));
				network.change_password(user.id, {
					oldPassword:inputList[0].value,
					newPassword:inputList[1].value
				});
			}, false);
			
			changepwdWebview.addEventListener('hide',function(){
				mui.each(inputList,function(index,item){
					item.value = '';
				});
			},false);
		});
		
		function changePasswordSuccess(data) {
			mui.toast('密码修改成功');
			mui.back();
		}
	</script>
</body>
</html>