<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>充值</title>
    <link rel="stylesheet" type="text/css" href="../css/mui.min.css"/>
    <link href="../css/mui.picker.min.css" rel="stylesheet" />
	<link href="../css/mui.poppicker.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="../css/own.css"/>
    <style type="text/css">
    	.mui-input-row label {width: 100%; color: #00B82B}
    	.upload-row {padding:11px 15px; line-height: 1.1; color: #333333; height: 50px!important;}
    	.qrcode-con {text-align: center; padding:15px 0; display: none;}
    	.qrcode-con img {width: 150px; height: 150px; margin:0 auto}
    	.selected select {font-size: 15px; padding:10px 15px}
    	.mui-icon-arrowdown {position: absolute; right: 10px; top:8px; pointer-events: none;}
    </style>
</head>
<body>
	<header class="mui-bar mui-bar-nav own-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">充值</h1>
	</header>
	
	<div id="inputPay" class="mui-content" style="margin: 10px;display: none;">
		<form class="mui-input-group">
			<div class="mui-input-row selected">
				<select id="channelPicker">
					<option value="0">选择支付方式</option>
					<option value="3">网上银行</option>
				</select>
				<span class="mui-icon mui-icon-arrowdown"></span>
			</div>
			<div id="webBank">
				<div class="mui-input-row" class="mui-input-clear">
					<input type="number" class="mui-input-clear" id="amount" placeholder="充值金额" />
				</div>
			</div>
		</form>
		<div class="mui-button-row" style="margin-top: 10px;">
			<button type="button" id="sendBtn" class="mui-btn own-btn-green mui-btn-block" style="padding: 5px 0px;">送出</button>
		</div>
	</div>
	
	<div id="showPay" class="mui-content" style="margin: 10px;">
		<p>订单号:  <font style="position:absolute;right: 10%;" id="orderId"></font></p>
		<p>充值金额:<font style="position:absolute;right: 10%;" id="orderAmount"></font><a onclick="copy_fun(document.getElementById('orderAmount').innerHTML)">点击复制</a></p>
		<p>姓          名:<font style="position:absolute;right: 10%;" id="orderName"></font><a onclick="copy_fun(document.getElementById('orderName').innerHTML)">点击复制</a></p>
		<p>银行卡号:<font style="position:absolute;right: 10%;" id="bankNo"></font><a onclick="copy_fun(document.getElementById('bankNo').innerHTML)">点击复制</a></p>
		<p>银行名称:<font style="position:absolute;right: 10%;" id="bankName"></font></p>
		<p>充值金额请点击复制</p>
		<p>金额不正确不会加点</p>
		<p>注:有任何问题请马上直接联系线上客服</p>		
	</div>
	
	<div id="errorPay" class="mui-content" style="margin: 10px;">
		<p>订单建立失败，请稍后再试或联系线上客服</p>
	</div>
	
	<script type="text/javascript" src="../js/mui.min.js" ></script>
	<script src="../js/mui.picker.min.js"></script>
	<script src="../js/mui.poppicker.js"></script>
	<script type="text/javascript" src="../js/own.js" ></script>
	<script type="text/javascript" src="../js/network.js" ></script>
	<script type="text/javascript">
		mui.init({
			swipeBack:true
		});
		
		var channelPicker;
		var sendBtn;
		var selectedChannelId = 0;
		mui.ready(function(){
			document.getElementById("inputPay").style.display = '';
			document.getElementById("showPay").style.display = 'none';
			document.getElementById("errorPay").style.display = 'none';
		});
		mui.plusReady(function() {
			channelPicker = document.getElementById("channelPicker");
			sendBtn = document.getElementById("sendBtn");
			
			channelPicker.addEventListener('change', function() {
				selectedChannelId = this.value;
			}, false);
			
			//保存
			sendBtn.addEventListener('tap', function() {
				if (selectedChannelId == 0) {
					mui.toast('请选择支付方式');
					return;
				}
				
				network.get_payment_infomation({
					amount: document.getElementById("amount").value*100,
					channel: selectedChannelId
				});
			}, false);			
		});
		
		function getPaymentInfomationSuccess(data){
			countDownProgessLoad("等候订单成立中...",30,1000,sendPaymentInfomationError);
			document.getElementById("inputPay").style.display = 'none';
			network.send_payment_infomation(data.result);
		}
		
		function sendPaymentInfomationSuccess(data){
			endLoad();
			document.getElementById("orderId").innerHTML = data.orderId;
			document.getElementById("orderAmount").innerHTML = data.amount;
			document.getElementById("orderName").innerHTML = data.name;
			document.getElementById("bankNo").innerHTML = data.bankNo;
			document.getElementById("bankName").innerHTML = data.bankName;
			document.getElementById("showPay").style.display = '';
		}
		
		function sendPaymentInfomationError(){
			endLoad();
			document.getElementById("errorPay").style.display = '';
		}
	</script>
</body>
</html>