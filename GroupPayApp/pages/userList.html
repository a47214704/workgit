<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>用户列表</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<link href="../css/mui.min.css" rel="stylesheet" />
	<link rel="stylesheet" type="text/css" href="../css/own.css"/>
	<style type="text/css">
		.mui-table-view-cell {position: relative;}
		h5 {padding:1px 0;}
		h5 em {display: inline-block; width: 80px; font-style: normal;}
		.focus {color: #333333; font-size: 16px;}
		.mui-btn-block {padding:9px 15px; margin:0; font-size: 15px}
		.select {border-bottom: 1px solid #c8c7cc; margin-bottom: 10px; position: relative;}
		.mui-icon-arrowdown {position: absolute; right: 10px; top:8px; pointer-events: none;}
	</style>
</head>
<body>
	<header class="mui-bar mui-bar-nav own-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">下级列表</h1>
	</header>
	<!--下拉刷新容器-->
	<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
		<div class="select">
			<select class="mui-btn mui-btn-block" id="selectBtn">
				<option value="1">用户类型：代理</option>
				<option value="2">用户类型：会员</option>
			</select>
			<span class="mui-icon mui-icon-arrowdown"></span>
		</div>
		<div class="mui-scroll" id="userList"></div>
	</div>
	
	<script type="text/javascript" src="../js/mui.min.js"></script>
	<script type="text/javascript" src="../js/own.js" ></script>
	<script type="text/javascript" src="../js/network.js" ></script>
	<script type="text/javascript">
		var userList;
		var selectBtn;
		var isAgent;
		var pageToken = "";
		var page = 0;
		mui.init({
			swipeBack:true,
			pullRefresh: {
				container: '#pullrefresh',
				down: {
					style:'circle',
					callback: pulldownRefresh
				}
			}
		});
		
		mui.plusReady(function(){
			var self = plus.webview.currentWebview();			
			
			userList = document.getElementById("userList");
			selectBtn = document.getElementById("selectBtn");			
			selectBtn.addEventListener('change', function() {
				if(this.value == 1) {
					changeUserType(true);
				} else {
					changeUserType(false);
				}
			}, false);
			
			changeUserType(self.isAgent);
		});
		
		function changeUserType(agent) {
			isAgent = agent;
			if(agent){				
				selectBtn.options[0].selected = true;
			} else {
				selectBtn.options[1].selected = true;
			}
			pulldownRefresh();
		}
		
		function pulldownRefresh() {
			var user = JSON.parse(localStorage.getItem('user'));
			network.get_child_user_list(user.id, isAgent, page, pageToken);
		}
		
		function childUserListSuccess(data) {
			mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
			if (data.result.records.length > 0) {				
				setHtml(data.result.records);							
			} else {
				userList.innerHTML = '';
			}
		}
		
		function setHtml(data) {
			var html = '<ul class="mui-table-view my-table-view">';
			mui.each(data, function(index, user) {
				html += '<li class="mui-table-view-cell" oid="'+user.id+'">';
				html += '<h5 class="focus">用戶：'+user.accountName+'</h5>';
				html += '<h5><em>用户编号</em><span class="txt-red">'+user.id+'</span></h5>';
				html += '<h5><em>用户余额</em><span class="txt-red">'+(parseInt(user.balance)/100)+'</span></h5>';
				html += '<span class="ctrl-field">';
				html += '<a href="#" oid="'+user.id+'" class="ctrl-btn agree">查看</a>';
				html += '</span>';
				html += '</li>';
			});
			html += '</ul>';
			userList.innerHTML = html;
		}
		
	</script>
</body>
</html>
